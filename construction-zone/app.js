!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=window.PIXI;var h=s;const a=s.Loader.shared,r=a.resources;const n=[{name:"player",url:"assets/player.png",metadata:{spritesheet:{frames:{idle_0:{frame:{x:0,y:0,w:16,h:16}},idle_1:{frame:{x:16,y:0,w:16,h:16}},down_0:{frame:{x:0,y:16,w:16,h:16}},down_1:{frame:{x:16,y:16,w:16,h:16}},down_2:{frame:{x:32,y:16,w:16,h:16}},down_3:{frame:{x:48,y:16,w:16,h:16}},down_4:{frame:{x:64,y:16,w:16,h:16}},down_5:{frame:{x:80,y:16,w:16,h:16}},down_6:{frame:{x:96,y:16,w:16,h:16}},down_7:{frame:{x:112,y:16,w:16,h:16}},right_0:{frame:{x:0,y:32,w:16,h:16}},right_1:{frame:{x:16,y:32,w:16,h:16}},right_2:{frame:{x:32,y:32,w:16,h:16}},right_3:{frame:{x:48,y:32,w:16,h:16}},right_4:{frame:{x:64,y:32,w:16,h:16}},right_5:{frame:{x:80,y:32,w:16,h:16}},right_6:{frame:{x:96,y:32,w:16,h:16}},right_7:{frame:{x:112,y:32,w:16,h:16}},left_0:{frame:{x:0,y:48,w:16,h:16}},left_1:{frame:{x:16,y:48,w:16,h:16}},left_2:{frame:{x:32,y:48,w:16,h:16}},left_3:{frame:{x:48,y:48,w:16,h:16}},left_4:{frame:{x:64,y:48,w:16,h:16}},left_5:{frame:{x:80,y:48,w:16,h:16}},left_6:{frame:{x:96,y:48,w:16,h:16}},left_7:{frame:{x:112,y:48,w:16,h:16}},up_0:{frame:{x:0,y:64,w:16,h:16}},up_1:{frame:{x:16,y:64,w:16,h:16}},up_2:{frame:{x:32,y:64,w:16,h:16}},up_3:{frame:{x:48,y:64,w:16,h:16}},up_4:{frame:{x:64,y:64,w:16,h:16}},up_5:{frame:{x:80,y:64,w:16,h:16}},up_6:{frame:{x:96,y:64,w:16,h:16}},up_7:{frame:{x:112,y:64,w:16,h:16}},building_0:{frame:{x:0,y:80,w:16,h:16}},building_1:{frame:{x:16,y:80,w:16,h:16}}},animations:{idle:["idle_0","idle_1"],down:["down_0","down_1","down_2","down_3","down_4","down_5","down_6","down_7"],right:["right_0","right_1","right_2","right_3","right_4","right_5","right_6","right_7"],left:["left_0","left_1","left_2","left_3","left_4","left_5","left_6","left_7"],up:["up_0","up_1","up_2","up_3","up_4","up_5","up_6","up_7"],building:["building_0","building_1"]},meta:{scale:"1"}}}},{name:"entities",url:"assets/entities.png",metadata:{spritesheet:{frames:{hazard_0:{frame:{x:0,y:0,w:16,h:16}},hazard_1:{frame:{x:16,y:0,w:16,h:16}},hazard_2:{frame:{x:32,y:0,w:16,h:16}},hazard_3:{frame:{x:48,y:0,w:16,h:16}},hazard_4:{frame:{x:64,y:0,w:16,h:16}},hazard_5:{frame:{x:80,y:0,w:16,h:16}},hazard_6:{frame:{x:96,y:0,w:16,h:16}},hazard_7:{frame:{x:112,y:0,w:16,h:16}},tower_0:{frame:{x:0,y:16,w:16,h:16}},tower_1:{frame:{x:16,y:16,w:16,h:16}},tower_2:{frame:{x:32,y:16,w:16,h:16}}},meta:{scale:"1"}}}},{name:"bulletTravel",url:"assets/bullet_travel.png",metadata:{spritesheet:{frames:{travel_0:{frame:{x:0,y:0,w:16,h:16}},travel_1:{frame:{x:16,y:0,w:16,h:16}},travel_2:{frame:{x:32,y:0,w:16,h:16}},travel_3:{frame:{x:48,y:0,w:16,h:16}},travel_4:{frame:{x:64,y:0,w:16,h:16}},travel_5:{frame:{x:0,y:16,w:16,h:16}},travel_6:{frame:{x:16,y:16,w:16,h:16}},travel_7:{frame:{x:32,y:16,w:16,h:16}},travel_8:{frame:{x:48,y:16,w:16,h:16}},travel_9:{frame:{x:64,y:16,w:16,h:16}},travel_10:{frame:{x:0,y:32,w:16,h:16}},travel_11:{frame:{x:16,y:32,w:16,h:16}},travel_12:{frame:{x:32,y:32,w:16,h:16}},travel_13:{frame:{x:48,y:32,w:16,h:16}},travel_14:{frame:{x:64,y:32,w:16,h:16}},travel_15:{frame:{x:0,y:48,w:16,h:16}},travel_16:{frame:{x:16,y:48,w:16,h:16}},travel_17:{frame:{x:32,y:48,w:16,h:16}},travel_18:{frame:{x:48,y:48,w:16,h:16}},travel_19:{frame:{x:64,y:48,w:16,h:16}},travel_20:{frame:{x:0,y:64,w:16,h:16}},travel_21:{frame:{x:16,y:64,w:16,h:16}},travel_22:{frame:{x:32,y:64,w:16,h:16}},travel_23:{frame:{x:48,y:64,w:16,h:16}}},animations:{travel:["travel_0","travel_1","travel_2","travel_3","travel_4","travel_5","travel_6","travel_7","travel_8","travel_9","travel_10","travel_11","travel_12","travel_13","travel_14","travel_15","travel_16","travel_17","travel_18","travel_19","travel_20","travel_21","travel_22","travel_23","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0","travel_0"]},meta:{scale:"1"}}}}],o=320,l=210,d=960,u=720;var p={easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}};class m{constructor(t){this._values=t,this._pressed=0,this._pressedThisFrame=!1,this._releasedThisFrame=!1,this._downListener=this._onKeyDown.bind(this),this._upListener=this._onKeyUp.bind(this),window.addEventListener("keydown",this._downListener,!1),window.addEventListener("keyup",this._upListener,!1)}isDown(){return this._pressed}pressed(){return this._pressedThisFrame}isUp(){return!this._pressed}released(){return this._releasedThisFrame}_onKeyDown(t){this._values.includes(t.key)&&(t.repeat||(this._pressed=!0,this._pressedThisFrame=!0),t.preventDefault())}_onKeyUp(t){this._values.includes(t.key)&&(t.repeat||(this._pressed=!1,this._releasedThisFrame=!0),t.preventDefault())}update(){this._pressedThisFrame=!1,this._releasedThisFrame=!1}destroy(){window.removeEventListener("keydown",this._downListener),window.removeEventListener("keyup",this._upListener)}}window.Input=new class{constructor(t){this.keys={};for(let e in t)this.keys[e]=new m(t[e]),this[e]=this.keys[e]}update(){for(let t in this.keys)this.keys[t].update()}}({moveRight:["d"],moveUp:["w"],moveLeft:["a"],moveDown:["s"],shootRight:["ArrowRight"],shootUp:["ArrowUp"],shootLeft:["ArrowLeft"],shootDown:["ArrowDown"],confirm:[" "],action1:["z"],action2:["x"],action3:["c"],back:["Escape"]});var y=window.Input;class x extends h.AnimatedSprite{constructor(t){const e=t.spritesheet.animations,i=Object.keys(e)[0];super(e[i]),this.animations=e,this.animation=i}play(t,e){t!==this.animation&&(this.textures=this.animations[t],this.animation=t),this.animationSpeed=e||1,super.play()}}class c extends h.Container{constructor(t,e,i){super(),this.zIndex=-2,this.x=t,this.y=e,this.rotation=i}update(t){}}class w extends c{constructor(t,e,i){super(t,e,i),this.sprite=new h.Sprite(r.entities.spritesheet.textures[w.SPRITE]),this.sprite.x=-8,this.sprite.y=-8,this.addChild(this.sprite),this.shootTimer=400*Math.random()}update(t){switch(this.parent.state){case q.ACTION:this.shootTimer=Math.max(0,this.shootTimer-t),0===this.shootTimer&&(this.parent.spawnBullet(this.x,this.y,Math.cos(this.rotation),Math.sin(this.rotation)),this.shootTimer=400,r.laserShoot.sound.play());break;case q.INTERMISSION:}}}w.SPRITE="tower_0",w.COST=10;class v extends c{constructor(t,e,i){super(t,e,i),this.sprite=new h.Sprite(r.entities.spritesheet.textures[v.SPRITE]),this.sprite.x=-8,this.sprite.y=-8,this.addChild(this.sprite),this.defaultRotation=i,this.shootTimer=300*Math.random()}update(t){switch(this.parent.state){case q.ACTION:let e={x:Math.cos(this.defaultRotation),y:Math.sin(this.defaultRotation)},i=null,s=0,h=0;for(let t of this.parent.hazards){let a={x:t.x-this.x,y:t.y-this.y},r=Math.sqrt(a.x*a.x+a.y*a.y);(e.x*a.x+e.y*a.y)/r>=Math.cos(Math.PI/4)&&(null==i||r<s)&&(i=t,s=r,h=Math.atan2(a.y,a.x))}null!==i&&(this.rotation=h),this.shootTimer=Math.max(0,this.shootTimer-t),0===this.shootTimer&&(this.parent.spawnBullet(this.x,this.y,Math.cos(this.rotation),Math.sin(this.rotation)),this.shootTimer=300,r.laserShoot.sound.play());break;case q.INTERMISSION:}}}v.SPRITE="tower_1",v.COST=20;class f extends c{constructor(t,e,i){super(t,e,i),this.sprite=new h.Sprite(r.entities.spritesheet.textures[f.SPRITE]),this.sprite.x=-8,this.sprite.y=-8,this.addChild(this.sprite),this.shootTimer=200*Math.random()}update(t){switch(this.parent.state){case q.ACTION:let e=null,i=0,s=0;for(let t of this.parent.hazards){let h={x:t.x-this.x,y:t.y-this.y},a=Math.sqrt(h.x*h.x+h.y*h.y);(null==e||a<i)&&(e=t,i=a,s=Math.atan2(h.y,h.x))}null!==e&&(this.rotation=s),this.shootTimer=Math.max(0,this.shootTimer-t),0===this.shootTimer&&(this.parent.spawnBullet(this.x,this.y,Math.cos(this.rotation),Math.sin(this.rotation)),this.shootTimer=200,r.laserShoot.sound.play());break;case q.INTERMISSION:}}}f.SPRITE="tower_2",f.COST=30;const _=[w,v,f],b=0,g=1;class S extends h.Container{constructor(){super(),this.health=3,this.speed=1.5,this.direction={x:0,y:0},this.sprite=new x(r.player),this.sprite.x=-8,this.sprite.y=-8,this.sprite.play("idle",.125),this.addChild(this.sprite),this.building=new h.Sprite,this.building.x=-8,this.building.y=-28,this.building.visible=!1,this.addChild(this.building),this.buildingCost=new h.BitmapText("",{fontName:"Lilian",fontSize:12}),this.buildingCost.y=-42,this.buildingCost.visible=!1,this.addChild(this.buildingCost),this.state=b,this.shootCooldown=0,this.footstepCooldown=0,this.invincibilityCooldown=0,this.buildingIndex=0}input(){let t={x:0,y:0};y.moveRight.isDown()&&(t.x+=1),y.moveLeft.isDown()&&(t.x-=1),y.moveUp.isDown()&&(t.y-=1),y.moveDown.isDown()&&(t.y+=1);const e=Math.sqrt(t.x*t.x+t.y*t.y);return 0!=e&&(t.x/=e,t.y/=e),t}update(t){switch(this.state){case b:this.building.visible=!1,this.buildingCost.visible=!1,this.setDirection(this.input()),this.x+=this.direction.x*this.speed*t,this.y+=this.direction.y*this.speed*t,this.x=Math.max(8,Math.min(o-8,this.x)),this.y=Math.max(8,Math.min(l-8,this.y)),this.direction.x>0?this.sprite.play("right",.275):this.direction.x<0?this.sprite.play("left",.275):this.direction.y>0?this.sprite.play("down",.275):this.direction.y<0?this.sprite.play("up",.275):this.sprite.play("idle",.125),this.footstepCooldown=Math.max(0,this.footstepCooldown-t),this.footstepCooldown<=0&&(0!=this.direction.x||0!=this.direction.y)&&(r.footstep.sound.play(),this.footstepCooldown=14),this.parent.state==q.INTERMISSION&&y.action1.pressed()&&(this.state=g,this.sprite.play("building",.125),r.openMenu.sound.play());break;case g:this.building.texture=r.entities.spritesheet.textures[_[this.buildingIndex].SPRITE],this.building.visible=!0,this.buildingCost.visible=!0,this.buildingCost.text="$"+_[this.buildingIndex].COST,this.buildingCost.x=-this.buildingCost.textWidth/2,y.action1.pressed()&&(this.state=b,r.closeMenu.sound.play()),y.shootRight.pressed()&&this.tryBuy(_[this.buildingIndex],0),y.shootDown.pressed()&&this.tryBuy(_[this.buildingIndex],Math.PI/2),y.shootLeft.pressed()&&this.tryBuy(_[this.buildingIndex],Math.PI),y.shootUp.pressed()&&this.tryBuy(_[this.buildingIndex],3*Math.PI/2),y.moveRight.pressed()&&(this.buildingIndex=(this.buildingIndex+1)%_.length),y.moveLeft.pressed()&&(this.buildingIndex=(this.buildingIndex+_.length-1)%_.length)}switch(this.parent.state){case q.ACTION:this.state=b,this.updateShoot(t),this.invincibilityCooldown=Math.max(0,this.invincibilityCooldown-t),this.sprite.visible=Math.floor(.15*this.invincibilityCooldown)%2==0;break;case q.INTERMISSION:this.shootCooldown=0,this.invincibilityCooldown=0,this.sprite.visible=!0}}tryBuy(t,e){this.parent.tryBuy(t,e)&&(this.state=b)}updateShoot(t){this.shootCooldown=Math.max(0,this.shootCooldown-t),0==this.shootCooldown&&(y.shootRight.isDown()?this.shoot(1,0):y.shootUp.isDown()?this.shoot(0,-1):y.shootLeft.isDown()?this.shoot(-1,0):y.shootDown.isDown()&&this.shoot(0,1))}shoot(t,e){this.parent.spawnBullet(this.x,this.y,t,e),this.shootCooldown=80,r.playerShoot.sound.play()}setDirection(t){this.direction=t}takeDamage(t){0==this.invincibilityCooldown&&(this.health=Math.max(0,this.health-t),this.invincibilityCooldown=100,r.damage.sound.play())}get collider(){return{x:this.x,y:this.y,width:8,height:8}}}class M extends h.Container{constructor(t,e){super();let i=Number(localStorage.getItem("record")||"0");t>i&&localStorage.setItem("record",t.toString()),this.time=0;let s=e?"YOU WIN":"GAME OVER";this.title=new h.BitmapText(s,{fontName:"Lilian",fontSize:24}),this.title.x=(o-this.title.textWidth)/2,this.title.y=-(this.title.textHeight+20),this.addChild(this.title),this.instructions=new h.BitmapText("Press space to try again",{fontName:"Lilian",fontSize:12,tint:15116288}),this.instructions.x=(o-this.instructions.textWidth)/2,this.instructions.y=200,this.instructions.visible=!1,this.addChild(this.instructions),this.buildSprite=new x(r.player),this.buildSprite.x=152,this.buildSprite.y=124,this.buildSprite.visible=!1,this.buildSprite.play("building",.125),this.buildSprite.visible=!1,this.addChild(this.buildSprite),this.score=new h.BitmapText(`★ ${t} ★`,{fontName:"Lilian",fontSize:24,tint:15116288}),this.score.x=(o-this.score.textWidth)/2,this.score.y=75,this.score.visible=!1,this.addChild(this.score);let a=`Record: ${i} `;t>i&&(a="NEW RECORD"),this.bestScore=new h.BitmapText(a,{fontName:"Lilian",fontSize:12}),this.bestScore.x=(o-this.bestScore.textWidth)/2,this.bestScore.y=100,this.bestScore.visible=!1,this.addChild(this.bestScore),this.music=r.titleMusic.sound.play()}update(t){this.time+=t;const e=Math.min(1,.01*this.time);this.title.y=20+(this.title.textHeight+20)*(p.easeOutBounce(e)-1);const i=.025*this.time-3;let s=i>0;if(this.buildSprite.visible=s,this.score.visible=s,this.bestScore.visible=s,this.instructions.visible=i>0&&Math.floor(i)%2==0,y.confirm.pressed()){if(s)return new $;this.time=120}if(y.back.pressed()){if(s)return new G;this.time=120}}destroy(){super.destroy(),this.music.destroy()}}class I extends h.Container{constructor(){super(),this._dead=!1}kill(){this._dead=!0}isDead(){return this._dead}}class C extends I{constructor(t,e,i,s){super(),this.x=t,this.y=e,this.vx=i,this.vy=s,this.rotation=Math.atan2(s,i),this.sprite=new h.Sprite(r.bullet.texture),this.sprite.x=-4,this.sprite.y=-1.5,this.addChild(this.sprite)}update(t){this.x+=this.vx*t,this.y+=this.vy*t;(this.x<-4||this.x>o+4||this.y<-4||this.y>l+4)&&this.kill()}hit(){this.kill()}get damage(){return 1}get collider(){let t=4,e=1.5;if(0==this.vx){let i=t;t=e,e=i}return{x:this.x,y:this.y,width:t,height:e}}}class T extends I{constructor(t,e,i,s){super(),this.x=t,this.y=e,this.value=1,this.health=i,this.size={x:8*s,y:8*s},this.sprite=new h.Sprite,this.sprite.x=-this.size.x,this.sprite.y=-this.size.y,this.sprite.scale.x=s,this.sprite.scale.y=s,this.addChild(this.sprite)}update(t){let e=Math.min(7,this.health-1);this.sprite.texture=r.entities.spritesheet.textures["hazard_"+e]}takeDamage(t){this.health>0&&(this.health=Math.max(0,this.health-t),0==this.health?this.kill():r.hit.sound.play())}get collider(){return{x:this.x,y:this.y,width:this.size.x,height:this.size.y}}kill(){super.kill(),r.explode.sound.play()}}class E extends T{constructor(t,e,i,s,h,a){super(t,e,i,s),this.vx=h,this.vy=a}update(t){super.update(t),this.x+=this.vx*t,this.y+=this.vy*t;let e=this.y+this.size.y>=l&&this.vy>0,i=this.y-this.size.y<=0&&this.vy<0;(e||i)&&(this.vy=-this.vy);let s=this.x+this.size.x>=o&&this.vx>0,h=this.x-this.size.x<=0&&this.vx<0;(s||h)&&(this.vx=-this.vx)}}class N extends T{constructor(t,e,i,s,h,a,r,n){super(Math.cos(h)*r+i,Math.sin(h)*r+s,t,e),this.cx=i,this.cy=s,this.fAngle=h,this.initial=a,this.outer=r,this.inner=n,this.time=0}update(t){super.update(t),this.time+=t;let e=0;let i=Math.sin(this.time/100*Math.PI/2);e=this.time<100?(1-i)*this.initial+i*this.inner:(1-i)*this.outer+i*this.inner;this.fAngle+=.01*t,this.x=this.cx+e*Math.cos(this.fAngle),this.y=this.cy+e*Math.sin(this.fAngle)}}const z=Math.sqrt(Math.pow(o/2,2)+Math.pow(l/2,2)),L=Math.min(o,l)/2;function O(t){let e=2*Math.random()*Math.PI;return{x:o/2+Math.cos(e)*t,y:l/2+Math.sin(e)*t}}function k(t,e){let i=e.x-t.x,s=e.y-t.y,h=Math.sqrt(i*i+s*s);return{x:i/h,y:s/h}}function R(t){return"function"==typeof t?t():t}class D{constructor(t){this.game=t}update(t){}}function B(t,e,i,s,h){for(let a=0;a<e;++a){let e=O(z+20),a=k(e,O(L-20)),r=R(h);t.addHazard(new E(e.x,e.y,R(i),R(s),a.x*r,a.y*r))}}function W(t,e,i,s,h,a,r,n){let o=R(h),l=R(a),d=R(r),u=R(n);for(let h=0;h<e;++h){let a=h/e*2*Math.PI;t.addHazard(new N(R(i),R(s),o,l,a,z+20,d,u))}}function A(t,e,i,s,h,a,r){for(let n=0;n<e;++n){let o=l*(n+.5+r)/e;t.addHazard(new E(h,o,R(i),R(s),a,0))}}class P extends D{constructor(t,e){super(t),this.duration=48*e}update(t){super.update(t),this.duration=Math.max(0,this.duration-t),0===this.duration&&this.game.advanceWave()}}class H extends D{constructor(t){super(t)}update(t){super.update(t),0===this.game.hazards.length&&this.game.advanceWave()}}class U extends D{constructor(t){super(t),this.boss=new T(-l/2,l/2,25,l/16),this.game.addHazard(this.boss),this.time=0,B(t,6,2,1,1.5)}update(t){if(super.update(t),this.boss.isDead())return void this.game.advanceWave();let e=Math.floor(this.time/20);this.time+=t/48;let i=Math.floor(this.time/20),s=Math.min(1,this.time%20/2);this.boss.x=-l/2+(i+p.easeOutBounce(s))*o/4,e!=i&&B(this.game,6-i,2,1,1.5)}}function V(t,e){return()=>t+Math.round(Math.random()*(e-t))}var F=[{name:"LEVEL ONE",waves:[t=>(B(t,5,1,1,1.5),new H(t)),t=>(B(t,5,1,1,1.5),new H(t))]},{name:"LEVEL TWO",waves:[t=>(B(t,5,V(1,2),1,1.5),new H(t)),t=>(B(t,5,V(1,2),1,1.5),new P(t,5)),t=>(B(t,5,V(1,2),1,1.5),new H(t,5))]},{name:"LEVEL THREE",waves:[t=>(B(t,5,1,1,2),new H(t)),t=>(B(t,3,1,1,1.5),B(t,4,2,2,1.5),new H(t))]},{name:"LEVEL FOUR",waves:[t=>(W(t,7,1,1,o/2,l/2,100,70),new P(t,3)),t=>(B(t,5,V(1,2),1,1.5),new H(t))]},{name:"LEVEL FIVE",waves:[t=>(W(t,4,V(1,2),1,o/2-30,l/2,100,70),W(t,4,V(1,2),1,o/2+30,l/2,100,70),new P(t,4)),t=>(B(t,4,2,1,1.5),new H(t))]},{name:"LEVEL SIX",waves:[t=>(A(t,5,3,1,-10,1,-.25),A(t,5,3,1,o+10,-1,.25),new P(t,6)),t=>(B(t,5,1,1,1.5),new H(t))]},{name:"LEVEL SEVEN",waves:[t=>(W(t,8,3,1,o/2,l/2,80,60),A(t,5,V(1,2),1,-10,1,-.25),new P(t,9)),t=>(B(t,7,V(1,3),1,1.5),new H(t))]},{name:"LEVEL EIGHT",waves:[t=>(A(t,5,3,2,-10,1,0),new P(t,5)),t=>(B(t,5,V(2,3),1,1.5),new P(t,3)),t=>(W(t,6,3,2,o/2,l/2,100,70),new H(t))]},{name:"LEVEL NINE",waves:[t=>(A(t,5,8,2,-10,.25,0),A(t,5,8,2,o+10,-.25,0),new P(t,10)),t=>(W(t,5,4,1,o/2-40,l/2,30,30),new P(t,2)),t=>(W(t,5,4,1,o/2+40,l/2,30,30),new P(t,5)),t=>(B(t,6,3,1,2),new H(t))]},{name:"FINAL BOSS",waves:[t=>new U(t)]}];function j(t,e){let i=t.x-t.width,s=t.x+t.width,h=t.y-t.height,a=t.y+t.height,r=e.x-e.width,n=e.x+e.width,o=e.y-e.height,l=e.y+e.height;return i<n&&s>r&&h<l&&a>o}const q={ACTION:0,INTERMISSION:1};class $ extends h.Container{constructor(){super(),this.x=0,this.y=30,this.sortableChildren=!0;let t=new h.Sprite(r.header.texture);t.y=-30,t.zIndex=1,this.addChild(t),this.levelName=new h.BitmapText("",{fontName:"Lilian",fontSize:16}),this.levelName.x=(o-this.levelName.textWidth)/2,this.levelName.y=-27,this.levelName.zIndex=1,this.addChild(this.levelName),this.health=new h.BitmapText("",{fontName:"Lilian",fontSize:16}),this.health.x=5,this.health.y=-27,this.health.zIndex=1,this.addChild(this.health),this.bank=new h.BitmapText("",{fontName:"Lilian",fontSize:16}),this.bank.x=o-this.bank.textWidth-5,this.bank.y=-27,this.bank.zIndex=1,this.addChild(this.bank),this.instructions=new h.BitmapText("Press space to continue",{fontName:"Lilian",fontSize:12,tint:15116288}),this.instructions.x=(o-this.instructions.textWidth)/2,this.instructions.y=170,this.instructions.visible=!1,this.instructions.zIndex=-1,this.addChild(this.instructions),this.player=new S,this.player.x=o/2,this.player.y=l/2,this.player.zIndex=1,this.addChild(this.player),this.state=q.ACTION,this.levelIndex=0,this.time=0,this.money=0,this.earned=0,this.bullets=[],this.hazards=[],this.towers=[],this.music=r.gameMusic.sound.play(),this.action()}update(t){switch(this.time+=t,this.player.update(t),this.state){case q.ACTION:if(null===this.wave){if(this.levelIndex==F.length-1)return new M(this.earned,!0);this.intermission();break}if(this.updateHazards(t),this.updateBullets(t),this.updateTowers(t),this.player.health<=0)return new M(this.earned,!1);this.health.text="♥ ".repeat(this.player.health),this.levelName.text=F[this.levelIndex].name,this.bank.text="$ "+this.money,this.instructions.visible=!1;break;case q.INTERMISSION:y.confirm.pressed()&&this.action(),this.health.text=this.earned+" ★",this.levelName.text="♩ INTERMISSION ♩",this.bank.text="$ "+this.money,this.instructions.visible=Math.floor(.025*this.time)%2==0}this.bullets=this.clean(this.bullets),this.hazards=this.clean(this.hazards),null!=this.wave&&this.wave.update(t),this.levelName.x=(o-this.levelName.textWidth)/2,this.bank.x=o-this.bank.textWidth-5}clean(t){let e=[];for(let i of t)i.isDead()?i.destroy():e.push(i);return e}destroy(){super.destroy(),this.music.destroy()}spawnBullet(t,e,i,s){let h=new C(t,e,3*i,3*s);this.addChild(h),this.bullets.push(h)}updateHazards(t){this.hazards=this.hazards.filter(t=>!t._destroyed);for(let e of this.hazards)e.update(t),j(this.player.collider,e.collider)&&this.player.takeDamage(1)}updateBullets(t){for(let e of this.bullets){e.update(t);for(let t of this.hazards)!t.isDead()&&j(e.collider,t.collider)&&(t.takeDamage(e.damage),e.hit(),t.isDead()&&(this.money+=t.value,this.earned+=t.value))}}updateTowers(t){for(let e of this.towers)e.update(t)}addMoney(t){this.money+=t,this.earned+=t}addHazard(t){this.addChild(t),this.hazards.push(t)}startWave(){this.wave=F[this.levelIndex].waves[this.waveIndex](this)}advanceWave(){this.waveIndex+=1,this.waveIndex<F[this.levelIndex].waves.length?this.startWave():this.wave=null}action(){let t=Math.floor(.1*this.money);t>0&&(this.addMoney(t),r.interest.sound.play()),this.state=q.ACTION,r.waveStart.sound.play(),this.time=0,this.waveIndex=0,this.startWave()}intermission(){for(let t of this.bullets)t.destroy();this.bullets=[];for(let t of this.hazards)t.destroy();this.hazards=[],this.time=0,this.player.health=3,this.state=q.INTERMISSION,this.levelIndex=Math.min(F.length-1,this.levelIndex+1),r.waveEnd.sound.play()}tryBuy(t,e){if(this.money>=t.COST){this.money-=t.COST;let i=new t(this.player.x,this.player.y,e);return this.addChild(i),this.towers.push(i),r.money.sound.play(),!0}return r.error.sound.play(),!1}}class G extends h.Container{constructor(){super(),this.time=0,this.title=new h.BitmapText("CONSTRUCTION ZONE",{fontName:"Lilian",fontSize:24}),this.title.x=(o-this.title.textWidth)/2,this.title.y=-(this.title.textHeight+20),this.addChild(this.title),this.controls=new h.Sprite(r.controls.texture),this.controls.visible=!1,this.addChild(this.controls),this.instructions=new h.BitmapText("Press space to continue",{fontName:"Lilian",fontSize:12,tint:15116288}),this.instructions.x=(o-this.instructions.textWidth)/2,this.instructions.y=200,this.instructions.visible=!1,this.addChild(this.instructions),this.moveSprite=new x(r.player),this.moveSprite.x=62,this.moveSprite.y=104,this.moveSprite.visible=!1,this.moveSprite.play("right",.275),this.addChild(this.moveSprite),this.shootSprite=new x(r.player),this.shootSprite.x=141,this.shootSprite.y=104,this.shootSprite.visible=!1,this.shootSprite.play("idle",.125),this.addChild(this.shootSprite),this.bulletSprite=new x(r.bulletTravel),this.bulletSprite.x=155,this.bulletSprite.y=104,this.bulletSprite.visible=!1,this.bulletSprite.play("travel",.75),this.addChild(this.bulletSprite),this.buildSprite=new x(r.player),this.buildSprite.x=240,this.buildSprite.y=104,this.buildSprite.visible=!1,this.buildSprite.play("building",.125),this.addChild(this.buildSprite),this.music=r.titleMusic.sound.play()}update(t){this.time+=t;const e=Math.min(1,.01*this.time);this.title.y=20+(this.title.textHeight+20)*(p.easeOutBounce(e)-1);const i=.025*this.time-3;let s=i>0;this.controls.visible=s,this.moveSprite.visible=s,this.shootSprite.visible=s,this.bulletSprite.visible=s,this.buildSprite.visible=s,this.instructions.visible=i>0&&Math.floor(i)%2==0;if(this.moveSprite.play(["right","up","left","down"][Math.floor(Math.max(0,i)/2)%4],.275),y.confirm.pressed()){if(s)return new $;this.time=120}}destroy(){super.destroy(),this.music.destroy()}}let K="WebGL";h.utils.isWebGLSupported()||(K="canvas"),h.utils.sayHello(K),h.settings.SCALE_MODE=h.SCALE_MODES.NEAREST;let X,Y=new h.Application({width:d,height:u,antialias:!1,transparent:!1,resolution:1});function Z(t){void 0!==X&&X.destroy(),X=t,Y.stage.addChild(X)}document.getElementById("game").appendChild(Y.view),a.use((function(t,e){if("spritesheet"in t.metadata){const i=new h.Spritesheet(t.texture,t.metadata.spritesheet);i.parse(()=>{t.spritesheet=i,t.textures=i.textures,e()})}else e()})).add([{name:"font",url:"assets/lilian.fnt"},{name:"bullet",url:"assets/bullet.png"},{name:"controls",url:"assets/controls.png"},{name:"header",url:"assets/header.png"},{name:"titleMusic",url:"assets/glouglou.mp3"},{name:"gameMusic",url:"assets/skate.mp3"},{name:"footstep",url:"assets/footstep.mp3"},{name:"playerShoot",url:"assets/player_shoot.mp3"},{name:"waveStart",url:"assets/wave_start.mp3"},{name:"waveEnd",url:"assets/wave_end.mp3"},{name:"damage",url:"assets/damage.mp3"},{name:"hit",url:"assets/hit.mp3"},{name:"explode",url:"assets/explode.mp3"},{name:"money",url:"assets/money.mp3"},{name:"interest",url:"assets/interest.mp3"},{name:"laserShoot",url:"assets/laser_shoot.mp3"},{name:"error",url:"assets/error.mp3"},{name:"openMenu",url:"assets/open_menu.mp3"},{name:"closeMenu",url:"assets/close_menu.mp3"}]).add(n).load((function(){Y.ticker.add(t=>function(t){let e=X.update(t);void 0!==e&&Z(e);y.update()}(t)),Y.stage.scale.x=3,Y.stage.scale.y=3,r.titleMusic.sound.loop=!0,r.gameMusic.sound.volume=.4,r.gameMusic.sound.loop=!0,r.footstep.sound.volume=.75,r.waveStart.sound.volume=.5,r.waveEnd.sound.volume=.5,r.interest.sound.volume=.25,r.laserShoot.sound.volume=.25,r.openMenu.sound.volume=.75,r.closeMenu.sound.volume=.75,Z(new G)}))}]);